package com.example.emo;

import android.graphics.Typeface;
import android.os.Bundle;
import android.util.TypedValue;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.LinearLayout;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.cardview.widget.CardView;
import androidx.core.content.ContextCompat;
import androidx.fragment.app.Fragment;

import com.example.emo.databinding.FragmentRelaxationBinding;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class RelaxationFragment extends Fragment {

    private FragmentRelaxationBinding binding;
    private LinearLayout relaxationContainer;
    private Map<String, List<Technique>> techniqueCategories;

    @Override
    public View onCreateView(
            @NonNull LayoutInflater inflater, ViewGroup container,
            Bundle savedInstanceState
    ) {
        binding = FragmentRelaxationBinding.inflate(inflater, container, false);
        return binding.getRoot();
    }

    public void onViewCreated(@NonNull View view, Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);

        relaxationContainer = binding.relaxationContainer;
        
        // Инициализация данных
        initializeTechniques();
        
        // Отображение методик
        displayTechniqueCategories();
    }
    
    private void initializeTechniques() {
        // Создаем категории методик
        techniqueCategories = new HashMap<>();
        techniqueCategories.put("Дыхательные техники", new ArrayList<>());
        techniqueCategories.put("Релаксационные техники", new ArrayList<>());
        
        
        // Каждое упражнение становится отдельной техникой со своей карточкой
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Упражнение «Отдых»",
                "Помогает расслабить шею и плечи через наклоны, снимает напряжение.",
                "Исходное положение — стоя, выпрямиться, поставить ноги на ширину плеч. Вдох. На выдохе наклониться, расслабив шею и плечи так, чтобы голова и руки свободно свисали к полу. Дышать глубоко, следить за своим дыханием. Находиться в таком положении в течение 1–2 минут. Затем медленно выпрямиться."
            )
        );
        
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Упражнение «Передышка»",
                "Техника для ситуаций, когда мы расстроены и сдерживаем дыхание.",
                "Обычно, когда мы бываем чем-то расстроены, мы начинаем сдерживать дыхание. Высвобождение дыхания — один из способов расслабления. В течение трех минут дышите медленно, спокойно и глубоко. Можете даже закрыть глаза. Наслаждайтесь этим глубоким неторопливым дыханием, представьте, что все ваши неприятности улетучиваются."
            )
        );
        
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Упражнение «Успокоение»",
                "Техника дыхания с счетом и задержкой для достижения состояния спокойствия.",
                "Сидя или стоя постарайтесь по возможности расслабить мышцы тела и сосредоточьте внимание на дыхании. На счет 1-2-3-4 делайте медленный глубокий вдох (при этом живот выпячивается вперед, а грудная клетка неподвижна);\n— на следующие четыре счета проводится задержка дыхания;\n— затем плавный вдох на счет 1-2-3-4-5-6;\n— снова задержка перед следующим вдохом на счет 1-2-3-4.\nУже через 3–5 минут такого дыхания вы заметите, что ваше состояние стало заметно спокойней и уравновешенней."
            )
        );
        
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Упражнение «Пушинка»",
                "Техника для развития плавного и контролируемого дыхания.",
                "Представьте, что перед вашим носом на расстоянии 10–12 см висит пушинка. Дышите только носом и так плавно, чтобы пушинка не колыхалась."
            )
        );
        
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Упражнение «Вдох с задержкой дыхания»",
                "Техника для ситуаций раздражения или гнева, когда мы забываем делать нормальный вдох.",
                "Поскольку в ситуации раздражения, гнева мы забываем делать нормальный вдох:\n— глубоко вдохните;\n— задержите дыхание так долго, как сможете;\n— сделайте несколько глубоких вдохов;\n— снова задержите дыхание;\n— выдох."
            )
        );
        
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Упражнение «Дыхание при стрессе»",
                "Ритмическое дыхание, сочетаемое с ходьбой для снятия стресса.",
                "Для этого рекомендуется использовать ритмическое полное дыхание. Лучше всего его сочетать с ритмичной неторопливой ходьбой, которая и задает дыхательный ритм. Вначале придерживайтесь ритма два шага вдох, два шага выдох. Затем увеличивайте продолжительность выдоха: два шага - вдох, три шага - выдох."
            )
        );
        
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Упражнение «Естественное дыхание»",
                "Методика восстановления естественного типа дыхания с использованием диафрагмы.",
                "Для восстановления естественного типа дыхания необходимо помнить, что диафрагма — самая сильная мышца для вдоха, а брюшной пресс (живот) — для выдоха. Если эти мышцы функционируют правильно, то при вдохе живот немного выпячивается, диафрагма уплотняется и нажимает на внутренности, таким образом массируя их. А при выдохе живот уменьшается (сокращаются мышцы брюшного пресса, и диафрагма принимает куполообразное положение). Диафрагмальное дыхание лучше всего проводить лежа на спине, согнув колени, однако этому виду дыхания необходимо научиться и в положении сидя."
            )
        );
        
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Упражнение «Осознанное дыхание»",
                "Техника постепенного углубления дыхания с медленным выдохом.",
                "Сядьте удобно, расслабьтесь, спину держите прямо. Делайте неглубокий вдох, выдох, затем второй — глубже, выдох, и третий — полной грудью, после чего выдыхайте медленно, чтобы выдох по времени был равен трем вдохам."
            )
        );
        
        // Добавляем технику дыхания 4-7-8
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Техника дыхания 4-7-8",
                "Мощная техника для быстрого снятия стресса, тревоги и напряжения. Помогает уснуть и улучшает контроль эмоций.",
                "Техника дыхания 4-7-8 (по методу доктора Эндрю Вейла)\n\nЭта техника является мощным инструментом для быстрого снятия стресса и тревоги. Она также очень эффективна для тех, кто страдает бессонницей.\n\nКак выполнять:\n\n1. Сядьте удобно с прямой спиной.\n2. Положите кончик языка к нёбу за передними верхними зубами (и держите его там на протяжении всего упражнения).\n3. Полностью выдохните через рот, создавая тихий свистящий звук.\n4. Закройте рот и спокойно вдохните через нос, считая до 4.\n5. Задержите дыхание, считая до 7.\n6. Сделайте полный выдох через рот со свистящим звуком, считая до 8.\n7. Это один цикл. Повторите цикл еще 3 раза (всего 4 цикла).\n\nЭффекты от регулярной практики:\n• Снижение уровня стресса и тревоги\n• Улучшение качества сна\n• Повышение устойчивости к стрессу\n• Снижение кровяного давления\n• Улучшение контроля эмоций\n\nВажно: Сначала упражнение выполняйте не более 4 циклов подряд. С опытом вы можете увеличить количество циклов, но начинайте именно с четырех. Выполняйте технику дважды в день, со временем вы заметите значительные улучшения в своем эмоциональном состоянии."
            )
        );
        
        // Добавляем коробочное дыхание
        techniqueCategories.get("Дыхательные техники").add(
            new Technique(
                "Коробочное дыхание",
                "Техника, используемая военными и спецназом для сохранения спокойствия в стрессовых ситуациях.",
                "Коробочное дыхание (квадратное дыхание)\n\nЭта техника также известна как «дыхание по квадрату» и широко используется военными, спецназом и профессиональными спортсменами для быстрого восстановления спокойствия и концентрации в стрессовых ситуациях.\n\nКак выполнять:\n\n1. Сядьте в удобное положение с прямой спиной.\n2. Выдохните полностью весь воздух из легких.\n3. Вдохните через нос, медленно считая до 4, наполняя легкие воздухом.\n4. Задержите дыхание, считая до 4.\n5. Медленно выдыхайте через рот, считая до 4.\n6. Задержите дыхание с пустыми легкими, считая до 4.\n7. Повторите цикл 4-5 раз или больше, пока не почувствуете себя спокойнее.\n\nПреимущества коробочного дыхания:\n• Быстрое снижение стресса и тревоги\n• Повышение концентрации и ясности ума\n• Регуляция нервной системы\n• Улучшение кислородного обмена\n• Снижение кровяного давления\n• Улучшение контроля эмоций\n\nКоробочное дыхание особенно полезно применять перед важными событиями, публичными выступлениями, во время напряженных ситуаций или при появлении симптомов тревоги. Регулярная практика этой техники помогает развить большую устойчивость к стрессу."
            )
        );
        
        
        // Упражнение "Быстрая релаксация"
        techniqueCategories.get("Релаксационные техники").add(
            new Technique(
                "Упражнение «Быстрая релаксация»",
                "Техника для быстрого снятия физического и психологического напряжения, помогает восстановить энергию.",
                "1. Лягте поудобнее, руки вдоль тела, закройте глаза и ничего не предпринимайте. Просто лежите.\n\n2. Подумайте о чем-нибудь приятном. Можете вспомнить что-либо или вообразить. Например, можете представить себе, что лежите на лугу возле ручья; день прекрасный, журчит ручей, пахнет травами.\n\n3. Если вам вспомнится или представится что-нибудь неприятное, о чем вам не хотелось бы думать, просто не реагируйте на это.\n\n4. Вызовите в себе ощущения, которые предшествуют вашему погружению в сон: тяжесть в руках, в ногах, чувство общей расслабленности. Мысленно и расслабленно (без напряжения) сосредоточьте на этом внимание. Через некоторое время вы почувствуете, что испытываете нечто подобное.\n\n5. Представьте, как ощущение расслабленности и покоя распространяется на все ваше тело.\n\n6. Почувствуйте, как с каждым последующим выдохом расслабленность и покой становятся все более ощутимыми.\n\n7. Если вам действительно будет хорошо, вы скажете себе, что это именно то, чего вы желали. Так и лежите, раз вам приятно.\n\n8. Можете просто отдыхать или потешить себя какими-нибудь приятными фантазиями. Представьте себе, что ваша душа как бы отправилась на прогулку по тем местам, где вы чувствуете себя хорошо.\n\n9. Продолжайте лежать до тех пор, пока вам это нравится, доставляет удовольствие.\n\n10. Не торопитесь с окончанием. Тело само подскажет оптимальный темп. Можно потереть глаза или потянуться, как после пробуждения. Сядьте лишь после того, как вам этого действительно захочется.\n\n11. Отследите свое состояние.\n\nЭта техника особенно эффективна для быстрого восстановления после стрессовых ситуаций или умственного переутомления. Даже 10-15 минут такой практики позволяют значительно улучшить самочувствие и повысить продуктивность."
            )
        );
        
        // Прогрессивная мышечная релаксация по Джекобсону
        techniqueCategories.get("Релаксационные техники").add(
            new Technique(
                "Прогрессивная мышечная релаксация по Джекобсону",
                "Метод осознанного напряжения и расслабления различных групп мышц для снятия физических зажимов.",
                "Прогрессивная мышечная релаксация по Джекобсону\n\nЭта техника была разработана американским физиологом Эдмундом Джекобсоном в 1920-х годах. Основной принцип заключается в том, что после сильного напряжения мышцы естественным образом расслабляются глубже. Техника помогает научиться распознавать и контролировать мышечное напряжение.\n\nКак выполнять:\n\n1. Займите удобное положение лежа или сидя.\n2. Начните с глубокого дыхания — сделайте 5-6 медленных вдохов и выдохов.\n3. Последовательно напрягайте и расслабляйте различные группы мышц. Каждую группу напрягайте на 5-7 секунд, затем расслабляйте на 20-30 секунд, концентрируясь на ощущении расслабления.\n\nПоследовательность мышечных групп:\n• Кисти рук — сожмите кулаки\n• Предплечья и плечи — согните руки в локтях и напрягите бицепсы\n• Плечи — поднимите к ушам\n• Верхняя часть спины — сведите лопатки вместе\n• Шея — осторожно откиньте голову назад\n• Лицо — напрягите лоб, сожмите челюсти, зажмурьте глаза\n• Грудь и живот — глубоко вдохните и напрягите мышцы\n• Ягодицы — напрягите ягодичные мышцы\n• Бедра — напрягите мышцы бедер\n• Голени — вытяните носки на себя\n• Стопы — подогните пальцы ног\n\nПосле завершения упражнения оставайтесь в состоянии расслабления еще 1-2 минуты, наслаждаясь ощущением покоя во всем теле.\n\nРегулярная практика (15-20 минут в день) помогает:\n• Уменьшить хроническое мышечное напряжение\n• Снизить уровень стресса и тревоги\n• Улучшить качество сна\n• Снизить интенсивность головных болей напряжения\n• Увеличить осознанность ощущений в теле\n• Улучшить контроль над физическими проявлениями эмоций\n\nЭту технику можно практиковать как полную последовательность перед сном или использовать частично в течение дня для быстрого снятия напряжения в конкретных группах мышц (например, расслабление плеч и шеи во время работы за компьютером)."
            )
        );
        
        // Техника визуализации "Безопасное место"
        techniqueCategories.get("Релаксационные техники").add(
            new Technique(
                "Визуализация «Безопасное место»",
                "Мощная техника для снятия тревоги и стресса через создание мысленного образа места, вызывающего чувство безопасности и комфорта.",
                "Визуализация «Безопасное место»\n\nВизуализация — это техника создания мысленных образов, которая активно используется в психотерапии, спортивной психологии и медитативных практиках. Техника «Безопасное место» помогает создать ментальное убежище, где вы можете почувствовать себя полностью защищенным и расслабленным.\n\nКак выполнять:\n\n1. Займите удобное положение, закройте глаза и сделайте несколько глубоких вдохов.\n\n2. Представьте место, где вы чувствуете себя абсолютно безопасно и комфортно. Это может быть реальное место из вашего опыта или воображаемое. Например, пляж, лес, горы, уютная комната, сад и т.д.\n\n3. Постепенно добавляйте детали к вашему образу:\n   • Что вы видите вокруг? Обратите внимание на цвета, формы, освещение.\n   • Какие звуки присутствуют? Шум волн, пение птиц, тишина...\n   • Какие запахи вы ощущаете? Морской бриз, аромат цветов, запах леса...\n   • Что вы чувствуете физически? Тепло солнца, прохладный ветерок, мягкость песка под ногами...\n   • Какие вкусы могут присутствовать? Возможно, свежие фрукты или прохладная вода...\n\n4. Полностью погрузитесь в этот образ, позвольте себе ощутить безопасность, покой и расслабление.\n\n5. Когда вы будете готовы вернуться, медленно сосчитайте от 5 до 1, на каждом счете ощущая, как возвращаетесь в настоящий момент.\n\n6. Откройте глаза, сохраняя чувство спокойствия и безопасности.\n\nПреимущества практики:\n• Быстрое снижение тревоги и стресса\n• Создание психологического ресурса для сложных ситуаций\n• Улучшение эмоциональной саморегуляции\n• Помощь при панических атаках\n• Улучшение сна при практике перед отходом ко сну\n\nВы можете записать описание вашего безопасного места или создать аудиозапись инструкций для себя, чтобы в моменты стресса быстрее погружаться в это состояние. С практикой простое воспоминание о вашем безопасном месте может вызывать ощущение спокойствия и защищенности даже в стрессовых ситуациях."
            )
        );
    }
    
    private void displayTechniqueCategories() {
        // Очищаем контейнер
        relaxationContainer.removeAllViews();
        
        // Создаем карточки для каждой категории методик
        for (Map.Entry<String, List<Technique>> category : techniqueCategories.entrySet()) {
            // Добавляем заголовок категории
            TextView categoryTitle = new TextView(getContext());
            categoryTitle.setText(category.getKey());
            categoryTitle.setTextColor(ContextCompat.getColor(getContext(), R.color.blue)); // Нежно-голубой цвет
            categoryTitle.setTextSize(TypedValue.COMPLEX_UNIT_SP, 24);
            categoryTitle.setTypeface(null, Typeface.BOLD);
            categoryTitle.setPadding(0, 16, 0, 16);
            relaxationContainer.addView(categoryTitle);
            
            // Добавляем карточки для каждой методики в категории
            for (Technique technique : category.getValue()) {
                addTechniqueCard(technique);
            }
        }
    }
    
    private void addTechniqueCard(Technique technique) {
        // Создаем карточку
        CardView cardView = new CardView(getContext());
        LinearLayout.LayoutParams cardParams = new LinearLayout.LayoutParams(
                LinearLayout.LayoutParams.MATCH_PARENT,
                LinearLayout.LayoutParams.WRAP_CONTENT
        );
        cardParams.setMargins(0, 8, 0, 8);
        cardView.setLayoutParams(cardParams);
        cardView.setCardElevation(8);
        cardView.setRadius(16);
        cardView.setCardBackgroundColor(ContextCompat.getColor(getContext(), R.color.card_background));
        
        // Контейнер для содержимого карточки
        LinearLayout cardContent = new LinearLayout(getContext());
        cardContent.setLayoutParams(new LinearLayout.LayoutParams(
                LinearLayout.LayoutParams.MATCH_PARENT,
                LinearLayout.LayoutParams.WRAP_CONTENT
        ));
        cardContent.setOrientation(LinearLayout.VERTICAL);
        cardContent.setPadding(24, 24, 24, 24);
        
        // Заголовок методики
        TextView titleView = new TextView(getContext());
        titleView.setText(technique.getTitle());
        titleView.setTextColor(ContextCompat.getColor(getContext(), R.color.text_color));
        titleView.setTextSize(TypedValue.COMPLEX_UNIT_SP, 18);
        titleView.setTypeface(null, Typeface.BOLD);
        cardContent.addView(titleView);
        
        // Описание методики
        TextView descriptionView = new TextView(getContext());
        descriptionView.setText(technique.getShortDescription());
        descriptionView.setTextColor(ContextCompat.getColor(getContext(), R.color.text_color));
        descriptionView.setTextSize(TypedValue.COMPLEX_UNIT_SP, 14);
        descriptionView.setPadding(0, 8, 0, 0);
        cardContent.addView(descriptionView);
        
        // Детальное описание методики (изначально скрыто)
        TextView detailsView = new TextView(getContext());
        detailsView.setText(technique.getDetailedDescription());
        detailsView.setTextColor(ContextCompat.getColor(getContext(), R.color.text_color));
        detailsView.setTextSize(TypedValue.COMPLEX_UNIT_SP, 14);
        detailsView.setPadding(0, 16, 0, 0);
        detailsView.setVisibility(View.GONE);
        cardContent.addView(detailsView);
        
        // Добавляем содержимое в карточку
        cardView.addView(cardContent);
        
        // Добавляем обработчик нажатия для разворачивания/сворачивания
        cardView.setOnClickListener(v -> {
            if (detailsView.getVisibility() == View.VISIBLE) {
                detailsView.setVisibility(View.GONE);
            } else {
                detailsView.setVisibility(View.VISIBLE);
            }
        });
        
        // Добавляем карточку в контейнер
        relaxationContainer.addView(cardView);
    }
    
    @Override
    public void onDestroyView() {
        super.onDestroyView();
        binding = null;
    }
    
    // Класс для хранения информации о методике или технике релаксации
    private static class Technique {
        private final String title;
        private final String shortDescription;
        private final String detailedDescription;
        
        public Technique(String title, String shortDescription, String detailedDescription) {
            this.title = title;
            this.shortDescription = shortDescription;
            this.detailedDescription = detailedDescription;
        }
        
        public String getTitle() {
            return title;
        }
        
        public String getShortDescription() {
            return shortDescription;
        }
        
        public String getDetailedDescription() {
            return detailedDescription;
        }
    }
} 